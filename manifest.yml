# Cloud Foundry Docker deployment manifest for OpenClaw
# Uses pre-built community Docker image (alpine/openclaw) with GenAI + S3 integration.
#
# Since Docker apps don't include local files, the command bootstraps by
# downloading .profile, start.sh, and s3-sync.cjs from GitHub at runtime.
#
# Deploy with: cf push -f manifest.yml
---
applications:
  - name: openclaw-docker
    memory: 2G
    disk_quota: 6G
    instances: 1

    docker:
      image: alpine/openclaw:latest

    command: >-
      bash -c '
        REPO="https://raw.githubusercontent.com/nkuhn-vmw/cf-openclaw/main"
        curl -sfL "$REPO/.profile" -o .profile
        curl -sfL "$REPO/start.sh" -o start.sh
        curl -sfL "$REPO/s3-sync.cjs" -o s3-sync.cjs
        chmod +x start.sh
        source .profile
        exec bash start.sh
      '

    env:
      NODE_ENV: production
      OPENCLAW_STATE_DIR: /home/node/data

    health-check-type: http
    health-check-http-endpoint: /
    timeout: 300

    routes:
      - route: openclaw-docker.apps.tas-tdc.kuhn-labs.com

    services:
      - tanzu-all-models
      - openclaw-storage
